<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Gapi - Google Places Search</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: 'Segoe UI', -apple-system, BlinkMacSystemFont, Roboto, sans-serif; background: #0f0f23; min-height: 100vh; color: #fff; }
    
    .header { background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%); padding: 30px 40px; border-bottom: 1px solid rgba(255,255,255,0.1); }
    .header h1 { font-size: 2em; margin-bottom: 8px; background: linear-gradient(90deg, #667eea, #764ba2, #f093fb); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; }
    .header p { color: rgba(255,255,255,0.6); font-size: 0.95em; }
    
    .search-section { background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%); padding: 30px 40px; display: flex; gap: 20px; align-items: flex-end; flex-wrap: wrap; border-bottom: 1px solid rgba(255,255,255,0.1); }
    .input-group { flex: 1; min-width: 250px; max-width: 400px; }
    .input-group label { display: block; margin-bottom: 8px; color: rgba(255,255,255,0.7); font-size: 13px; text-transform: uppercase; letter-spacing: 1px; }
    .input-group input, .input-group select { width: 100%; padding: 16px 20px; background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); border-radius: 12px; color: #fff; font-size: 16px; transition: all 0.3s; }
    .input-group input:focus, .input-group select:focus { outline: none; border-color: #667eea; background: rgba(102, 126, 234, 0.1); }
    .input-group select option { background: #1a1a2e; color: #fff; }
    
    .btn-search { padding: 16px 40px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; border-radius: 12px; cursor: pointer; font-size: 16px; font-weight: 600; transition: all 0.3s; }
    .btn-search:hover { transform: translateY(-2px); box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4); }
    .btn-search:disabled { opacity: 0.5; cursor: not-allowed; transform: none; }
    
    .stats-bar { display: flex; gap: 40px; padding: 25px 40px; background: rgba(255,255,255,0.02); border-bottom: 1px solid rgba(255,255,255,0.05); flex-wrap: wrap; }
    .stat { display: flex; align-items: center; gap: 15px; }
    .stat-icon { width: 50px; height: 50px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 22px; }
    .stat-info .label { color: rgba(255,255,255,0.5); font-size: 12px; text-transform: uppercase; letter-spacing: 1px; }
    .stat-info .value { color: #fff; font-size: 1.4em; font-weight: 700; }
    
    .results-section { padding: 40px; }
    .section-title { font-size: 1.5em; margin-bottom: 25px; color: rgba(255,255,255,0.9); }
    
    .cards-container { display: grid; grid-template-columns: repeat(4, 1fr); gap: 25px; }
    
    .place-card { background: linear-gradient(145deg, #1e1e3f 0%, #16162a 100%); border-radius: 20px; overflow: hidden; border: 1px solid rgba(255,255,255,0.05); transition: all 0.3s; opacity: 0; transform: translateY(20px); animation: fadeInUp 0.5s ease forwards; }
    .place-card:hover { transform: translateY(-5px); border-color: rgba(102, 126, 234, 0.3); box-shadow: 0 20px 40px rgba(0,0,0,0.3); }
    @keyframes fadeInUp { to { opacity: 1; transform: translateY(0); } }
    
    .card-header { padding: 25px; position: relative; }
    .card-header::after { content: ''; position: absolute; bottom: 0; left: 25px; right: 25px; height: 1px; background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent); }
    .card-header h3 { font-size: 1.3em; margin-bottom: 8px; color: #fff; }
    .card-type { display: inline-block; padding: 5px 12px; background: rgba(102, 126, 234, 0.2); color: #667eea; border-radius: 20px; font-size: 12px; text-transform: capitalize; }
    
    .card-body { padding: 25px; }
    .info-row { display: flex; align-items: flex-start; gap: 15px; margin-bottom: 18px; }
    .info-icon { width: 24px; height: 24px; background: rgba(255,255,255,0.05); border-radius: 8px; display: flex; align-items: center; justify-content: center; font-size: 14px; flex-shrink: 0; }
    .info-content { flex: 1; }
    .info-label { font-size: 11px; color: rgba(255,255,255,0.4); text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 4px; }
    .info-value { color: rgba(255,255,255,0.9); font-size: 14px; line-height: 1.4; }
    
    .rating-row { display: flex; align-items: center; gap: 12px; margin-bottom: 18px; }
    .rating-badge { display: flex; align-items: center; gap: 6px; background: rgba(244, 180, 0, 0.15); padding: 8px 14px; border-radius: 10px; }
    .rating-badge .star { color: #f4b400; font-size: 18px; }
    .rating-badge .score { font-weight: 700; font-size: 16px; }
    .review-count { color: rgba(255,255,255,0.5); font-size: 13px; }
    
    .status-row { display: flex; gap: 15px; flex-wrap: wrap; }
    .status-badge { display: flex; align-items: center; gap: 8px; padding: 8px 16px; border-radius: 10px; font-size: 13px; font-weight: 600; }
    .status-badge.open { background: rgba(19, 115, 51, 0.2); color: #4caf50; }
    .status-badge.closed { background: rgba(197, 34, 31, 0.2); color: #f44336; }
    .price-badge { background: rgba(15, 157, 88, 0.2); color: #0f9d58; }
    
    .card-footer { padding: 20px 25px; background: rgba(0,0,0,0.2); border-top: 1px solid rgba(255,255,255,0.05); }
    .place-id { font-size: 11px; color: rgba(255,255,255,0.3); font-family: monospace; word-break: break-all; }
    .coordinates { font-size: 11px; color: rgba(255,255,255,0.3); margin-top: 5px; }
    
    .loading { display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 80px 20px; color: rgba(255,255,255,0.6); }
    .spinner { width: 60px; height: 60px; border: 4px solid rgba(255,255,255,0.1); border-top-color: #667eea; border-radius: 50%; animation: spin 1s linear infinite; margin-bottom: 20px; }
    @keyframes spin { to { transform: rotate(360deg); } }
    
    .load-more { grid-column: 1 / -1; display: flex; justify-content: center; padding: 40px; }
    .load-more-btn { padding: 16px 48px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; border-radius: 12px; cursor: pointer; font-size: 16px; font-weight: 600; transition: all 0.3s; }
    .load-more-btn:hover { transform: translateY(-2px); box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4); }
    .load-more-btn:disabled { opacity: 0.5; cursor: not-allowed; transform: none; }
    
    .infinite-loader { grid-column: 1 / -1; display: flex; justify-content: center; padding: 20px; }
    .infinite-loader .spinner { width: 40px; height: 40px; margin-bottom: 0; }
    
    .no-results { text-align: center; padding: 80px 20px; color: rgba(255,255,255,0.5); }
    .no-results .icon { font-size: 64px; margin-bottom: 20px; opacity: 0.5; }
    .no-results h3 { font-size: 1.5em; margin-bottom: 10px; color: rgba(255,255,255,0.7); }
    
    .error { background: rgba(197, 34, 31, 0.1); border: 1px solid rgba(197, 34, 31, 0.3); color: #f44336; padding: 20px; border-radius: 12px; text-align: center; margin: 20px 40px; }
    
    @media (max-width: 1400px) { .cards-container { grid-template-columns: repeat(3, 1fr); } }
    @media (max-width: 1100px) { .cards-container { grid-template-columns: repeat(2, 1fr); } }
    @media (max-width: 768px) { .cards-container { grid-template-columns: 1fr; } .search-section, .stats-bar, .results-section { padding: 20px; } .header h1 { font-size: 1.5em; } }
  </style>
</head>
<body>
  <div class="header">
    <h1>üîç Gapi - Places Search</h1>
    <p>Discover the best places around the world</p>
  </div>
  
  <div class="search-section">
    <div class="input-group">
      <label>üìç Location</label>
      <input type="text" id="locationInput" list="locations" placeholder="Enter city or address" value="Delhi">
      <datalist id="locations">
        <option value="Delhi">
        <option value="Mumbai">
        <option value="Bangalore">
        <option value="Chennai">
        <option value="Kolkata">
        <option value="Hyderabad">
        <option value="Pune">
        <option value="New York">
        <option value="Los Angeles">
        <option value="San Francisco">
        <option value="London">
        <option value="Paris">
        <option value="Tokyo">
        <option value="Dubai">
        <option value="Singapore">
        <option value="Sydney">
        <option value="Toronto">
        <option value="Melbourne">
        <option value="Berlin">
        <option value="Amsterdam">
      </datalist>
    </div>
    
    <div class="input-group">
      <label>üè∑Ô∏è Place Type</label>
      <select id="typeInput">
        <option value="restaurants">Restaurants</option>
        <option value="cafes">Cafes</option>
        <option value="hotels">Hotels</option>
        <option value="hospitals">Hospitals</option>
        <option value="banks">Banks</option>
        <option value="gas stations">Gas Stations</option>
        <option value="shopping malls">Shopping Malls</option>
        <option value="parks">Parks</option>
        <option value="gyms">Gyms</option>
        <option value="schools">Schools</option>
        <option value="pharmacies">Pharmacies</option>
        <option value="bars">Bars & Pubs</option>
        <option value="beaches">Beaches</option>
        <option value="museums">Museums</option>
        <option value="airports">Airports</option>
      </select>
    </div>
    
    <button class="btn-search" onclick="searchPlaces()" id="searchBtn">Search</button>
  </div>
  
  <div class="stats-bar" id="stats" style="display: none;">
    <div class="stat">
      <div class="stat-icon">üìä</div>
      <div class="stat-info">
        <div class="label">Results</div>
        <div class="value" id="resultCount">0</div>
      </div>
    </div>
    <div class="stat">
      <div class="stat-icon">üìç</div>
      <div class="stat-info">
        <div class="label">Location</div>
        <div class="value" id="locationDisplay">-</div>
      </div>
    </div>
    <div class="stat">
      <div class="stat-icon">üè∑Ô∏è</div>
      <div class="stat-info">
        <div class="label">Category</div>
        <div class="value" id="typeDisplay">-</div>
      </div>
    </div>
  </div>
  
  <div class="results-section">
    <h2 class="section-title" id="sectionTitle">Search Results</h2>
    <div id="results" class="cards-container"></div>
    <div id="loadMoreContainer" class="load-more" style="display: none;">
      <button class="load-more-btn" onclick="loadMore()">Load More Results</button>
    </div>
    <div id="infiniteLoader" class="infinite-loader" style="display: none;">
      <div class="spinner"></div>
    </div>
  </div>

  <script>
    const API_URL = 'http://localhost:5000/api/places';
    
    // State management
    let allResults = [];
    let nextPageToken = null;
    let currentLocation = '';
    let currentType = '';
    let isLoading = false;
    
    function createCardHTML(place, index) {
      return `
        <div class="place-card" style="animation-delay: ${index * 0.1}s">
          <div class="card-header">
            <h3>${place.name}</h3>
            <span class="card-type">${place.types ? place.types[0].replace(/_/g, ' ') : 'Place'}</span>
          </div>
          <div class="card-body">
            <div class="info-row">
              <div class="info-icon">üìç</div>
              <div class="info-content">
                <div class="info-label">Address</div>
                <div class="info-value">${place.formatted_address || place.vicinity || 'N/A'}</div>
              </div>
            </div>
            <div class="rating-row">
              ${place.rating ? `
                <div class="rating-badge">
                  <span class="star">‚òÖ</span>
                  <span class="score">${place.rating}</span>
                </div>
                <span class="review-count">${place.user_ratings_total} reviews</span>
              ` : '<span class="review-count">No ratings yet</span>'}
            </div>
            <div class="status-row">
              <div class="status-badge ${place.opening_hours?.open_now ? 'open' : 'closed'}">
                ${place.opening_hours?.open_now ? '‚úì Open' : '‚úó Closed'}
              </div>
              ${place.price_level ? `
                <div class="status-badge price-badge">
                  üí∞ ${'$'.repeat(place.price_level)}
                </div>
              ` : ''}
              ${place.business_status ? `
                <div class="status-badge" style="background: rgba(255,255,255,0.1); color: rgba(255,255,255,0.7);">
                  üìã ${place.business_status}
                </div>
              ` : ''}
            </div>
          </div>
          <div class="card-footer">
            <div class="place-id">${place.place_id}</div>
            <div class="coordinates">Lat: ${place.geometry?.location?.lat?.toFixed(4) || 'N/A'}, Lng: ${place.geometry?.location?.lng?.toFixed(4) || 'N/A'}</div>
          </div>
        </div>
      `;
    }
    
    async function searchPlaces() {
      const location = document.getElementById('locationInput').value.trim();
      const type = document.getElementById('typeInput').value;
      const query = `${type} in ${location}`;
      const resultsDiv = document.getElementById('results');
      const searchBtn = document.getElementById('searchBtn');
      const statsDiv = document.getElementById('stats');
      const sectionTitle = document.getElementById('sectionTitle');
      const loadMoreContainer = document.getElementById('loadMoreContainer');
      const infiniteLoader = document.getElementById('infiniteLoader');

      if (!location) {
        resultsDiv.innerHTML = '<div class="error">Please enter a location</div>';
        return;
      }

      // Reset state
      allResults = [];
      nextPageToken = null;
      currentLocation = location;
      currentType = type;
      isLoading = true;

      resultsDiv.innerHTML = '<div class="loading"><div class="spinner"></div><p>Searching for places...</p></div>';
      searchBtn.disabled = true;
      statsDiv.style.display = 'none';
      loadMoreContainer.style.display = 'none';
      infiniteLoader.style.display = 'none';
      sectionTitle.textContent = `Searching in ${location}...`;

      try {
        const response = await fetch(`${API_URL}?query=${encodeURIComponent(query)}`);
        const data = await response.json();

        if (data.error) {
          resultsDiv.innerHTML = `<div class="error">${data.error}</div>`;
          isLoading = false;
          return;
        }

        if (!data.results || data.results.length === 0) {
          resultsDiv.innerHTML = `
            <div class="no-results" style="min-width: unset;">
              <div class="icon">üîç</div>
              <h3>No places found</h3>
              <p>Try a different location or category</p>
            </div>`;
          sectionTitle.textContent = 'No Results';
          isLoading = false;
          return;
        }

        // Store results and pagination token
        allResults = data.results;
        nextPageToken = data.next_page_token || null;

        // Update stats and title
        document.getElementById('resultCount').textContent = allResults.length;
        document.getElementById('locationDisplay').textContent = location;
        document.getElementById('typeDisplay').textContent = type.charAt(0).toUpperCase() + type.slice(1);
        statsDiv.style.display = 'flex';
        sectionTitle.textContent = `Top ${allResults.length} ${type.charAt(0).toUpperCase() + type.slice(1)} in ${location}`;

        // Render cards
        resultsDiv.innerHTML = allResults.map((place, index) => createCardHTML(place, index)).join('');

        // Show load more button if there's a next page
        if (nextPageToken) {
          loadMoreContainer.style.display = 'flex';
        }

        isLoading = false;
      } catch (error) {
        resultsDiv.innerHTML = `<div class="error">Failed to connect to API: ${error.message}</div>`;
        isLoading = false;
      } finally {
        searchBtn.disabled = false;
      }
    }
    
    async function loadMore() {
      if (isLoading || !nextPageToken) return;
      
      const loadMoreContainer = document.getElementById('loadMoreContainer');
      const infiniteLoader = document.getElementById('infiniteLoader');
      const resultsDiv = document.getElementById('results');
      const searchBtn = document.getElementById('searchBtn');
      
      isLoading = true;
      loadMoreContainer.style.display = 'none';
      infiniteLoader.style.display = 'flex';
      searchBtn.disabled = true;

      try {
        // Add pagetoken parameter to the existing query
        const location = currentLocation;
        const type = currentType;
        const query = `${type} in ${location}`;
        
        const response = await fetch(`${API_URL}?query=${encodeURIComponent(query)}&pagetoken=${encodeURIComponent(nextPageToken)}`);
        const data = await response.json();

        if (data.results && data.results.length > 0) {
          // Add new results to existing array
          allResults = [...allResults, ...data.results];
          nextPageToken = data.next_page_token || null;

          // Append new cards
          const newCardsHTML = data.results.map((place, index) => createCardHTML(place, allResults.length - data.results.length + index)).join('');
          resultsDiv.insertAdjacentHTML('beforeend', newCardsHTML);

          // Update result count
          document.getElementById('resultCount').textContent = allResults.length;
          sectionTitle.textContent = `Top ${allResults.length} ${type.charAt(0).toUpperCase() + type.slice(1)} in ${location}`;
        }

        // Show/hide load more button
        if (nextPageToken) {
          loadMoreContainer.style.display = 'flex';
        }
      } catch (error) {
        console.error('Error loading more results:', error);
        loadMoreContainer.style.display = 'flex';
      } finally {
        isLoading = false;
        infiniteLoader.style.display = 'none';
        searchBtn.disabled = false;
      }
    }

    // Allow Enter key to search
    document.getElementById('locationInput').addEventListener('keypress', (e) => {
      if (e.key === 'Enter') searchPlaces();
    });

    // Auto-search on type change
    document.getElementById('typeInput').addEventListener('change', () => {
      if (document.getElementById('locationInput').value.trim()) {
        searchPlaces();
      }
    });
  </script>
</body>
</html>
