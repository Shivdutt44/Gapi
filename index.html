<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Gapi - Google Places Search</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: 'Segoe UI', -apple-system, BlinkMacSystemFont, Roboto, sans-serif; background: #0f0f23; min-height: 100vh; color: #fff; }
    
    .header { background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%); padding: 30px 40px; border-bottom: 1px solid rgba(255,255,255,0.1); }
    .header h1 { font-size: 2em; margin-bottom: 8px; background: linear-gradient(90deg, #667eea, #764ba2, #f093fb); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; }
    .header p { color: rgba(255,255,255,0.6); font-size: 0.95em; }
    
    .search-section { background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%); padding: 30px 40px; display: flex; gap: 20px; align-items: flex-end; flex-wrap: wrap; border-bottom: 1px solid rgba(255,255,255,0.1); }
    .input-group { flex: 1; min-width: 250px; max-width: 400px; }
    .input-group label { display: block; margin-bottom: 8px; color: rgba(255,255,255,0.7); font-size: 13px; text-transform: uppercase; letter-spacing: 1px; }
    .input-wrapper { position: relative; }
    .location-input { width: 100%; padding: 16px 50px 16px 20px; background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); border-radius: 12px; color: #fff; font-size: 16px; transition: all 0.3s; }
    .location-input:focus { outline: none; border-color: #667eea; background: rgba(102, 126, 234, 0.1); }
    .location-input::placeholder { color: rgba(255,255,255,0.3); }
    .geo-btn { position: absolute; right: 10px; top: 50%; transform: translateY(-50%); background: none; border: none; cursor: pointer; font-size: 20px; padding: 8px; border-radius: 8px; transition: all 0.3s; }
    .geo-btn:hover { background: rgba(102, 126, 234, 0.2); }
    .geo-btn.loading { animation: pulse 1s infinite; }
    @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
    
    /* Place Type Select Styling */
    #typeInput {
      width: 100%;
      padding: 16px 20px;
      background: rgba(255,255,255,0.05);
      border: 1px solid rgba(255,255,255,0.1);
      border-radius: 12px;
      color: #fff;
      font-size: 16px;
      cursor: pointer;
      transition: all 0.3s;
      appearance: none;
      -webkit-appearance: none;
      -moz-appearance: none;
      background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%23ffffff' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e");
      background-repeat: no-repeat;
      background-position: right 12px center;
      background-size: 18px;
      padding-right: 40px;
    }
    #typeInput:focus {
      outline: none;
      border-color: #667eea;
      background-color: rgba(102, 126, 234, 0.1);
    }
    #typeInput:hover {
      border-color: rgba(255,255,255,0.2);
      background-color: rgba(255,255,255,0.08);
    }
    #typeInput option {
      background: #1a1a2e;
      color: #fff;
      padding: 12px;
      font-size: 16px;
    }
    
    .btn-search { padding: 16px 40px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; border-radius: 12px; cursor: pointer; font-size: 16px; font-weight: 600; transition: all 0.3s; }
    .btn-search:hover { transform: translateY(-2px); box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4); }
    .btn-search:disabled { opacity: 0.5; cursor: not-allowed; transform: none; }
    
    .stats-bar { display: flex; gap: 40px; padding: 25px 40px; background: rgba(255,255,255,0.02); border-bottom: 1px solid rgba(255,255,255,0.05); flex-wrap: wrap; }
    .stat { display: flex; align-items: center; gap: 15px; }
    .stat-icon { width: 50px; height: 50px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 22px; }
    .stat-info .label { color: rgba(255,255,255,0.5); font-size: 12px; text-transform: uppercase; letter-spacing: 1px; }
    .stat-info .value { color: #fff; font-size: 1.4em; font-weight: 700; }
    
    .results-section { padding: 40px; }
    .section-title { font-size: 1.5em; margin-bottom: 25px; color: rgba(255,255,255,0.9); }
    
    .cards-container { display: grid; grid-template-columns: repeat(4, 1fr); gap: 25px; }
    
    .place-card { background: linear-gradient(145deg, #1e1e3f 0%, #16162a 100%); border-radius: 20px; overflow: hidden; border: 1px solid rgba(255,255,255,0.05); transition: all 0.3s; opacity: 0; transform: translateY(20px); animation: fadeInUp 0.5s ease forwards; }
    .place-card:hover { transform: translateY(-5px); border-color: rgba(102, 126, 234, 0.3); box-shadow: 0 20px 40px rgba(0,0,0,0.3); }
    @keyframes fadeInUp { to { opacity: 1; transform: translateY(0); } }
    
    .card-image { width: 100%; height: 180px; object-fit: cover; background: rgba(255,255,255,0.05); position: relative; }
    .card-image-placeholder { width: 100%; height: 180px; display: flex; align-items: center; justify-content: center; background: linear-gradient(135deg, rgba(102, 126, 234, 0.2) 0%, rgba(118, 75, 162, 0.2) 100%); font-size: 48px; position: relative; }
    .card-image-container { position: relative; }
    
    .card-image-overlay { position: absolute; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.3); display: flex; align-items: center; justify-content: center; opacity: 0; transition: opacity 0.3s; backdrop-filter: blur(2px); z-index: 10; }
    .card-image:hover .card-image-overlay, .card-image-placeholder:hover .card-image-overlay { opacity: 1; }
    
    .view-detail-btn {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 1px;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
      border: 1px solid rgba(255,255,255,0.2);
    }
    
    .view-detail-btn:hover {
      background: linear-gradient(135deg, #5a6fd8 0%, #6a4190 100%);
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
      border-color: rgba(255,255,255,0.4);
    }
    
    /* Updated Eye Button Styling */
    .eye-btn {
      display: flex;
      align-items: center;
      gap: 8px;
      width: auto;
      height: auto;
      padding: 10px 24px;
      background: #fff;
      border: none;
      border-radius: 50px; /* Pill shape */
      cursor: pointer;
      color: #1a1a2e;
      font-size: 13px;
      font-weight: 700;
      transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
      box-shadow: 0 6px 20px rgba(0,0,0,0.25);
      text-transform: uppercase;
      letter-spacing: 0.8px;
    }
    .eye-btn svg {
      width: 18px;
      height: 18px;
      stroke-width: 2.5;
      flex-shrink: 0;
    }
    .eye-btn:hover {
      transform: scale(1.08);
      box-shadow: 0 8px 25px rgba(0,0,0,0.4);
      background: #fff;
      color: #667eea;
    }
    
    .card-header { padding: 25px; position: relative; display: flex; flex-direction: column; gap: 15px; }
    .card-header::after { content: ''; position: absolute; bottom: 0; left: 25px; right: 25px; height: 1px; background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent); }
    .card-header h3 { font-size: 1.3em; margin-bottom: 12px; color: #fff; }
    .card-types { display: flex; flex-wrap: wrap; gap: 8px; }
    .card-header-content { display: flex; justify-content: space-between; align-items: center; width: 100%; }
    .card-type { display: inline-block; padding: 5px 12px; background: rgba(102, 126, 234, 0.2); color: #667eea; border-radius: 20px; font-size: 12px; text-transform: capitalize; }
    
    .card-body { padding: 25px; }
    .info-row { display: flex; align-items: flex-start; gap: 15px; margin-bottom: 18px; }
    .info-icon { width: 24px; height: 24px; background: rgba(255,255,255,0.05); border-radius: 8px; display: flex; align-items: center; justify-content: center; font-size: 14px; flex-shrink: 0; }
    .info-content { flex: 1; }
    .info-label { font-size: 11px; color: rgba(255,255,255,0.4); text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 4px; }
    .info-value { color: rgba(255,255,255,0.9); font-size: 14px; line-height: 1.4; }
    
    .rating-row { display: flex; align-items: center; gap: 12px; margin-bottom: 18px; }
    .rating-badge { display: flex; align-items: center; gap: 6px; background: rgba(244, 180, 0, 0.15); padding: 8px 14px; border-radius: 10px; }
    .rating-badge .star { color: #f4b400; font-size: 18px; }
    .rating-badge .score { font-weight: 700; font-size: 16px; }
    .review-count { color: rgba(255,255,255,0.5); font-size: 13px; }
    
    .status-row { display: flex; gap: 15px; flex-wrap: wrap; }
    .status-badge { display: flex; align-items: center; gap: 8px; padding: 8px 16px; border-radius: 10px; font-size: 13px; font-weight: 600; }
    .status-badge.open { background: rgba(19, 115, 51, 0.2); color: #4caf50; }
    .status-badge.closed { background: rgba(197, 34, 31, 0.2); color: #f44336; }
    .price-badge { background: rgba(15, 157, 88, 0.2); color: #0f9d58; }
    
    .card-footer { padding: 20px 25px; background: rgba(0,0,0,0.2); border-top: 1px solid rgba(255,255,255,0.05); }
    .place-id { font-size: 11px; color: rgba(255,255,255,0.3); font-family: monospace; word-break: break-all; }
    .coordinates { font-size: 11px; color: rgba(255,255,255,0.3); margin-top: 5px; }
    
    .loading { display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 80px 20px; color: rgba(255,255,255,0.6); }
    .spinner { width: 60px; height: 60px; border: 4px solid rgba(255,255,255,0.1); border-top-color: #667eea; border-radius: 50%; animation: spin 1s linear infinite; margin-bottom: 20px; }
    @keyframes spin { to { transform: rotate(360deg); } }
    
    .infinite-loader { grid-column: 1 / -1; display: flex; justify-content: center; padding: 40px; }
    .infinite-loader .spinner { width: 50px; height: 50px; margin-bottom: 0; }
    
    .no-results { text-align: center; padding: 80px 20px; color: rgba(255,255,255,0.5); grid-column: 1 / -1; }
    .no-results .icon { font-size: 64px; margin-bottom: 20px; opacity: 0.5; }
    .no-results h3 { font-size: 1.5em; margin-bottom: 10px; color: rgba(255,255,255,0.7); }
    
    .error { background: rgba(197, 34, 31, 0.1); border: 1px solid rgba(197, 34, 31, 0.3); color: #f44336; padding: 20px; border-radius: 12px; text-align: center; margin: 20px 40px; }
    
    .sentinel { grid-column: 1 / -1; height: 20px; }
    
    /* Custom Toast Notification */
    .toast {
      visibility: hidden;
      min-width: 250px;
      background-color: #333;
      color: #fff;
      text-align: center;
      border-radius: 8px;
      padding: 16px;
      position: fixed;
      z-index: 1000;
      left: 50%;
      bottom: 30px;
      transform: translateX(-50%);
      font-size: 14px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.3);
      border: 1px solid rgba(255,255,255,0.1);
      opacity: 0;
      transition: opacity 0.3s, bottom 0.3s;
    }
    .toast.show {
      visibility: visible;
      opacity: 1;
      bottom: 50px;
    }
    
    @media (max-width: 1400px) { .cards-container { grid-template-columns: repeat(3, 1fr); } }
    @media (max-width: 1100px) { .cards-container { grid-template-columns: repeat(2, 1fr); } }
    @media (max-width: 768px) { .cards-container { grid-template-columns: 1fr; } .search-section, .stats-bar, .results-section { padding: 20px; } .header h1 { font-size: 1.5em; } }

    /* Modal Styles */
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      background: rgba(0, 0, 0, 0.8);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      backdrop-filter: blur(5px);
    }

    .modal-content {
      background: linear-gradient(145deg, #1e1e3f 0%, #16162a 100%);
      border-radius: 20px;
      width: 90vw;
      max-width: 800px;
      max-height: 90vh;
      overflow-y: auto;
      border: 1px solid rgba(255,255,255,0.1);
      box-shadow: 0 20px 40px rgba(0,0,0,0.5);
    }

    .modal-header {
      padding: 25px;
      border-bottom: 1px solid rgba(255,255,255,0.1);
      position: relative;
    }

    .close-btn {
      position: absolute;
      top: 15px;
      right: 15px;
      background: none;
      border: none;
      color: #fff;
      font-size: 24px;
      cursor: pointer;
      padding: 5px;
      border-radius: 50%;
      transition: background 0.3s;
    }

    .close-btn:hover {
      background: rgba(255,255,255,0.1);
    }

    .modal-title {
      font-size: 1.8em;
      margin-bottom: 10px;
      background: linear-gradient(90deg, #667eea, #764ba2, #f093fb);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .modal-types {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
    }

    .modal-type {
      display: inline-block;
      padding: 5px 12px;
      background: rgba(102, 126, 234, 0.2);
      color: #667eea;
      border-radius: 20px;
      font-size: 12px;
      text-transform: capitalize;
    }

    .modal-body {
      padding: 25px;
    }

    .images-section {
      margin-bottom: 25px;
    }

    .images-carousel {
      position: relative;
      width: 100%;
      height: 300px;
      overflow: hidden;
      border-radius: 12px;
      background: rgba(255,255,255,0.05);
    }

    .carousel-container {
      display: flex;
      width: 100%;
      height: 100%;
      transition: transform 0.3s ease;
    }

    .carousel-image {
      flex-shrink: 0;
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .carousel-nav {
      position: absolute;
      top: 50%;
      transform: translateY(-50%);
      background: rgba(0,0,0,0.5);
      border: none;
      color: #fff;
      font-size: 24px;
      padding: 10px;
      cursor: pointer;
      border-radius: 50%;
      transition: background 0.3s;
    }

    .carousel-nav:hover {
      background: rgba(0,0,0,0.8);
    }

    .carousel-prev {
      left: 10px;
    }

    .carousel-next {
      right: 10px;
    }

    .carousel-indicators {
      position: absolute;
      bottom: 10px;
      left: 50%;
      transform: translateX(-50%);
      display: flex;
      gap: 5px;
    }

    .indicator {
      width: 10px;
      height: 10px;
      border-radius: 50%;
      background: rgba(255,255,255,0.5);
      cursor: pointer;
      transition: background 0.3s;
    }

    .indicator.active {
      background: #667eea;
    }

    .details-section {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
      margin-bottom: 25px;
    }

    .detail-item {
      display: flex;
      align-items: flex-start;
      gap: 15px;
      padding: 15px;
      background: rgba(255,255,255,0.05);
      border-radius: 12px;
    }

    .detail-icon {
      width: 24px;
      height: 24px;
      background: rgba(255,255,255,0.1);
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 14px;
      flex-shrink: 0;
    }

    .detail-content {
      flex: 1;
    }

    .detail-label {
      font-size: 11px;
      color: rgba(255,255,255,0.4);
      text-transform: uppercase;
      letter-spacing: 0.5px;
      margin-bottom: 4px;
    }

    .detail-value {
      color: rgba(255,255,255,0.9);
      font-size: 14px;
      line-height: 1.4;
    }

    .detail-value a {
      color: #667eea;
      text-decoration: none;
    }

    .detail-value a:hover {
      text-decoration: underline;
    }

    .rating-section {
      margin-bottom: 25px;
    }

    .rating-display {
      display: flex;
      align-items: center;
      gap: 15px;
      padding: 20px;
      background: rgba(244, 180, 0, 0.1);
      border-radius: 12px;
    }

    .rating-badge {
      display: flex;
      align-items: center;
      gap: 8px;
      background: rgba(244, 180, 0, 0.2);
      padding: 12px 20px;
      border-radius: 10px;
    }

    .rating-star {
      color: #f4b400;
      font-size: 24px;
    }

    .rating-score {
      font-weight: 700;
      font-size: 20px;
      color: #f4b400;
    }

    .rating-count {
      color: rgba(255,255,255,0.6);
      font-size: 14px;
    }

    .reviews-section {
      margin-bottom: 25px;
    }

    .reviews-title {
      font-size: 1.2em;
      margin-bottom: 15px;
      color: rgba(255,255,255,0.9);
    }

    .review-item {
      padding: 15px;
      background: rgba(255,255,255,0.05);
      border-radius: 12px;
      margin-bottom: 10px;
    }

    .review-author {
      font-weight: 600;
      margin-bottom: 5px;
    }

    .review-rating {
      color: #f4b400;
      margin-bottom: 5px;
    }

    .review-text {
      color: rgba(255,255,255,0.8);
      line-height: 1.4;
    }

    .hours-section {
      margin-bottom: 25px;
    }

    .hours-title {
      font-size: 1.2em;
      margin-bottom: 15px;
      color: rgba(255,255,255,0.9);
    }

    .hours-list {
      background: rgba(255,255,255,0.05);
      border-radius: 12px;
      padding: 15px;
    }

    .hour-item {
      display: flex;
      justify-content: space-between;
      padding: 5px 0;
      color: rgba(255,255,255,0.8);
    }

    .hour-item.today {
      font-weight: 600;
      color: #667eea;
    }

    @media (max-width: 768px) {
      .modal-content {
        width: 95vw;
        max-height: 95vh;
      }

      .details-section {
        grid-template-columns: 1fr;
      }

      .images-carousel {
        height: 200px;
      }
    }
  </style>
</head>
<body>
  <div class="header">
    <h1>üîç Gapi - Places Search</h1>
    <p>Discover the best places around the world</p>
    <button class="eye-btn" onclick="showDeviceInfo()" style="margin-top: 15px;">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <rect x="2" y="3" width="20" height="14" rx="2" ry="2"></rect>
        <line x1="8" y1="21" x2="16" y2="21"></line>
        <line x1="12" y1="17" x2="12" y2="21"></line>
      </svg>
      Device Info
    </button>
  </div>
  
  <div class="search-section">
    <div class="input-group">
      <label>üìç Location</label>
      <div class="input-wrapper">
        <input type="text" id="locationInput" class="location-input" placeholder="Enter city or address" value="">
        <button class="geo-btn" id="geoBtn" onclick="getCurrentLocation()" title="Use my current location">
          üìç
        </button>
      </div>
      <datalist id="locations">
        <option value="Delhi">
        <option value="Mumbai">
        <option value="Bangalore">
        <option value="Chennai">
        <option value="Kolkata">
        <option value="Hyderabad">
        <option value="Pune">
        <option value="New York">
        <option value="Los Angeles">
        <option value="San Francisco">
        <option value="London">
        <option value="Paris">
        <option value="Tokyo">
        <option value="Dubai">
        <option value="Singapore">
        <option value="Sydney">
        <option value="Toronto">
        <option value="Melbourne">
        <option value="Berlin">
        <option value="Amsterdam">
      </datalist>
    </div>
    
    <div class="input-group">
      <label>üè∑Ô∏è Place Type</label>
      <select id="typeInput">
        <option value="all">All Places</option>
        <option value="restaurants">Restaurants</option>
        <option value="cafes">Cafes</option>
        <option value="hotels">Hotels</option>
        <option value="hospitals">Hospitals</option>
        <option value="banks">Banks</option>
        <option value="gas stations">Gas Stations</option>
        <option value="shopping malls">Shopping Malls</option>
        <option value="parks">Parks</option>
        <option value="gyms">Gyms</option>
        <option value="schools">Schools</option>
        <option value="pharmacies">Pharmacies</option>
        <option value="bars">Bars & Pubs</option>
        <option value="beaches">Beaches</option>
        <option value="museums">Museums</option>
        <option value="airports">Airports</option>
      </select>
    </div>
    
    <button class="btn-search" onclick="searchPlaces()" id="searchBtn">Search</button>
  </div>
  
  <div class="stats-bar" id="stats" style="display: none;">
    <div class="stat">
      <div class="stat-icon">üìä</div>
      <div class="stat-info">
        <div class="label">Results</div>
        <div class="value" id="resultCount">0</div>
      </div>
    </div>
    <div class="stat">
      <div class="stat-icon">üèôÔ∏è</div>
      <div class="stat-info">
        <div class="label">City</div>
        <div class="value" id="cityDisplay">Detecting...</div>
      </div>
    </div>
    <div class="stat">
      <div class="stat-icon">üìç</div>
      <div class="stat-info">
        <div class="label">Location</div>
        <div class="value" id="locationDisplay">-</div>
      </div>
    </div>
    <div class="stat">
      <div class="stat-icon">üè∑Ô∏è</div>
      <div class="stat-info">
        <div class="label">Category</div>
        <div class="value" id="typeDisplay">-</div>
      </div>
    </div>
  </div>
  
  <div class="results-section">
    <h2 class="section-title" id="sectionTitle">Search Results</h2>
    <div id="results" class="cards-container"></div>
    <div id="infiniteLoader" class="infinite-loader" style="display: none;">
      <div class="spinner"></div>
      <p style="margin-top: 10px; color: rgba(255,255,255,0.6);">Loading more results...</p>
    </div>
    <div id="sentinel" class="sentinel"></div>
  </div>
  
  <!-- Toast Notification Container -->
  <div id="toast" class="toast"></div>
  <div id="modal" class="modal-overlay" style="display: none;">
    <div class="modal-content">
      <div class="modal-header">
        <button class="close-btn" onclick="closeModal()">&times;</button>
        <h2 id="place-title" class="modal-title">Place Details</h2>
        <div id="place-types" class="modal-types"></div>
      </div>
      <div class="modal-body">
        <div class="images-section">
          <div class="images-carousel">
            <div id="carousel-container" class="carousel-container"></div>
            <button id="carousel-prev" class="carousel-nav carousel-prev" onclick="prevImage()">&#10094;</button>
            <button id="carousel-next" class="carousel-nav carousel-next" onclick="nextImage()">&#10095;</button>
            <div id="carousel-indicators" class="carousel-indicators"></div>
          </div>
        </div>
        <div class="details-section">
          <div class="detail-item">
            <div class="detail-icon">üìç</div>
            <div class="detail-content">
              <div class="detail-label">Address</div>
              <div id="place-address" class="detail-value">Loading...</div>
            </div>
          </div>
          <div class="detail-item">
            <div class="detail-icon">üìû</div>
            <div class="detail-content">
              <div class="detail-label">Phone</div>
              <div id="place-phone" class="detail-value">Loading...</div>
            </div>
          </div>
          <div class="detail-item">
            <div class="detail-icon">üåê</div>
            <div class="detail-content">
              <div class="detail-label">Website</div>
              <div id="place-website" class="detail-value">Loading...</div>
            </div>
          </div>
          <div class="detail-item">
            <div class="detail-icon">üìä</div>
            <div class="detail-content">
              <div class="detail-label">Status</div>
              <div id="place-status" class="detail-value">Loading...</div>
            </div>
          </div>
        </div>
        <div class="rating-section">
          <div id="rating-display" class="rating-display"></div>
        </div>
        <div class="hours-section">
          <h3 class="hours-title">Opening Hours</h3>
          <div id="place-hours" class="hours-list"></div>
        </div>
        <div class="reviews-section">
          <h3 class="reviews-title">Recent Reviews</h3>
          <div id="place-reviews"></div>
        </div>
      </div>
    </div>
  </div>

  <!-- Device Info Modal -->
  <div id="deviceModal" class="modal-overlay" style="display: none;">
    <div class="modal-content" style="max-width: 500px;">
      <div class="modal-header">
        <button class="close-btn" onclick="closeDeviceModal()">&times;</button>
        <h2 class="modal-title">Device Information</h2>
      </div>
      <div class="modal-body">
        <div class="details-section" style="grid-template-columns: 1fr;">
          <div class="detail-item">
            <div class="detail-icon">üìê</div>
            <div class="detail-content">
              <div class="detail-label">Screen Width</div>
              <div id="device-width" class="detail-value">Loading...</div>
            </div>
          </div>
          <div class="detail-item">
            <div class="detail-icon">üìè</div>
            <div class="detail-content">
              <div class="detail-label">Screen Height</div>
              <div id="device-height" class="detail-value">Loading...</div>
            </div>
          </div>
          <div class="detail-item">
            <div class="detail-icon">üñ•Ô∏è</div>
            <div class="detail-content">
              <div class="detail-label">Available Width</div>
              <div id="avail-width" class="detail-value">Loading...</div>
            </div>
          </div>
          <div class="detail-item">
            <div class="detail-icon">üìê</div>
            <div class="detail-content">
              <div class="detail-label">Available Height</div>
              <div id="avail-height" class="detail-value">Loading...</div>
            </div>
          </div>
          <div class="detail-item">
            <div class="detail-icon">üî¢</div>
            <div class="detail-content">
              <div class="detail-label">Color Depth</div>
              <div id="color-depth" class="detail-value">Loading...</div>
            </div>
          </div>
          <div class="detail-item">
            <div class="detail-icon">üì±</div>
            <div class="detail-content">
              <div class="detail-label">Pixel Ratio</div>
              <div id="pixel-ratio" class="detail-value">Loading...</div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    const API_BASE_URL = 'http://localhost:5000/api';
    const API_URL = `${API_BASE_URL}/places`;
    
    // State management
    let allResults = [];
    let nextPageToken = null;
    let currentLocation = '';
    let currentType = '';
    let isLoading = false;
    let observer = null;
    let currentImages = [];
    let currentImageIndex = 0;
    
    // Get current location on page load
    window.addEventListener('DOMContentLoaded', () => {
      getCurrentLocation();
    });
    
    // Get user's current location with full address
    async function getCurrentLocation() {
      const locationInput = document.getElementById('locationInput');
      const geoBtn = document.getElementById('geoBtn');
      const cityDisplay = document.getElementById('cityDisplay');
      
      if (!navigator.geolocation) {
        locationInput.placeholder = 'Geolocation not supported';
        cityDisplay.textContent = 'Not supported';
        return;
      }
      
      geoBtn.classList.add('loading');
      geoBtn.innerHTML = '‚è≥';
      
      navigator.geolocation.getCurrentPosition(
        async (position) => {
          const { latitude, longitude } = position.coords;
          
          // Try to get full address from coordinates
          try {
            const response = await fetch(`https://maps.googleapis.com/maps/api/geocode/json?latlng=${latitude},${longitude}&key=AIzaSyDq3eLU5UMm5kKZNvwyofR0bC3rMToQ-hw`);
            const data = await response.json();
            
            if (data.results && data.results.length > 0) {
              const result = data.results[0];
              const fullAddress = result.formatted_address;
              
              // Extract city name from address components
              const addressComponents = result.address_components || [];
              let cityName = '';
              
              for (const component of addressComponents) {
                if (component.types.includes('locality')) {
                  cityName = component.long_name;
                  break;
                } else if (component.types.includes('sublocality') && !cityName) {
                  cityName = component.long_name;
                }
              }
              
              // Update city display
              if (cityName) {
                cityDisplay.textContent = cityName;
                locationInput.value = cityName;
                currentLocation = cityName;
              } else if (fullAddress) {
                // Fallback: use first part of address
                const addressParts = fullAddress.split(', ');
                cityDisplay.textContent = addressParts[0] || fullAddress;
                locationInput.value = fullAddress;
                currentLocation = fullAddress;
              } else {
                cityDisplay.textContent = `${latitude.toFixed(2)}, ${longitude.toFixed(2)}`;
                locationInput.value = `${latitude.toFixed(4)}, ${longitude.toFixed(4)}`;
                currentLocation = locationInput.value;
              }
              
              // Auto-search with current location
              searchPlaces();
            } else {
              cityDisplay.textContent = `${latitude.toFixed(2)}, ${longitude.toFixed(2)}`;
              locationInput.value = `${latitude.toFixed(4)}, ${longitude.toFixed(4)}`;
              currentLocation = locationInput.value;
            }
          } catch (error) {
            cityDisplay.textContent = 'Unknown';
            locationInput.value = `${latitude.toFixed(4)}, ${longitude.toFixed(4)}`;
            currentLocation = locationInput.value;
          }
          
          geoBtn.classList.remove('loading');
          geoBtn.innerHTML = 'üìç';
        },
        (error) => {
          console.error('Geolocation error:', error);
          geoBtn.classList.remove('loading');
          geoBtn.innerHTML = 'üìç';
          cityDisplay.textContent = 'Permission denied';
          locationInput.placeholder = 'Enter city or address';
          locationInput.focus();
        },
        { enableHighAccuracy: true, timeout: 10000, maximumAge: 0 }
      );
    }
    
    function createCardHTML(place, index) {
      const photoUrl = place.photos && place.photos[0] 
        ? `https://maps.googleapis.com/maps/api/place/photo?maxwidth=400&photo_reference=${place.photos[0].photo_reference}&key=AIzaSyDq3eLU5UMm5kKZNvwyofR0bC3rMToQ-hw`
        : null;
      const typeEmoji = getTypeEmoji(place.types?.[0] || '');
      
      return `
        <div class="place-card" style="animation-delay: ${index * 0.1}s">
          ${photoUrl ?
            `<div class="card-image-container" style="position: relative;">
              <img class="card-image" src="${photoUrl}" alt="${place.name}" loading="lazy" onerror="this.style.display='none'; this.parentElement.querySelector('.card-image-placeholder').style.display='flex';">
              <div class="card-image-placeholder" style="display:none; position: absolute; top: 0; left: 0;">${typeEmoji}</div>
            </div>`
            :
            `<div class="card-image-container" style="position: relative;">
              <div class="card-image-placeholder">${typeEmoji}</div>
            </div>`
          }
          <div class="card-header">
            <div class="card-header-content">
              <div>
                <h3>${place.name}</h3>
                <div class="card-types">
                  ${place.types ? place.types.map(t => `<span class="card-type">${t.replace(/_/g, ' ')}</span>`).join('') : '<span class="card-type">Place</span>'}
                </div>
              </div>
              <button class="view-detail-btn" onclick="viewPlaceDetails('${place.place_id}')">View Detail</button>
            </div>
          </div>
          <div class="card-body">
            <div class="info-row">
              <div class="info-icon">üìç</div>
              <div class="info-content">
                <div class="info-label">Address</div>
                <div class="info-value">${place.formatted_address || place.vicinity || 'N/A'}</div>
              </div>
            </div>
            <div class="rating-row">
              ${place.rating ? `
                <div class="rating-badge">
                  <span class="star">‚òÖ</span>
                  <span class="score">${place.rating}</span>
                </div>
                <span class="review-count">${place.user_ratings_total} reviews</span>
              ` : '<span class="review-count">No ratings yet</span>'}
            </div>
            <div class="status-row">
              <div class="status-badge ${place.opening_hours?.open_now ? 'open' : 'closed'}">
                ${place.opening_hours?.open_now ? '‚úì Open' : '‚úó Closed'}
              </div>
              ${place.price_level ? `
                <div class="status-badge price-badge">
                  üí∞ ${'$'.repeat(place.price_level)}
                </div>
              ` : ''}
              ${place.business_status ? `
                <div class="status-badge" style="background: rgba(255,255,255,0.1); color: rgba(255,255,255,0.7);">
                  üìã ${place.business_status}
                </div>
              ` : ''}
            </div>
          </div>
          <div class="card-footer">
            <div class="place-id">${place.place_id}</div>
            <div class="coordinates">Lat: ${place.geometry?.location?.lat?.toFixed(4) || 'N/A'}, Lng: ${place.geometry?.location?.lng?.toFixed(4) || 'N/A'}</div>
          </div>
        </div>
      `;
    }
    
    // Helper function to get emoji based on place type
    function getTypeEmoji(type) {
      const emojis = {
        'restaurant': 'üçΩÔ∏è',
        'cafe': '‚òï',
        'bar': 'üç∏',
        'hotel': 'üè®',
        'hospital': 'üè•',
        'bank': 'üè¶',
        'gas_station': '‚õΩ',
        'shopping_mall': 'üõçÔ∏è',
        'park': 'üå≥',
        'gym': 'üí™',
        'school': 'üè´',
        'pharmacy': 'üíä',
        'beach': 'üèñÔ∏è',
        'museum': 'üèõÔ∏è',
        'airport': '‚úàÔ∏è',
        'default': 'üìç'
      };
      return emojis[type] || emojis[type.replace(/\s+/g, '_')] || emojis.default;
    }
    
    // Setup Intersection Observer for infinite scroll - triggers on little scroll
    function setupObserver() {
      if (observer) {
        observer.disconnect();
      }
      
      const sentinel = document.getElementById('sentinel');
      
      observer = new IntersectionObserver((entries) => {
        const entry = entries[0];
        if (entry.isIntersecting && nextPageToken && !isLoading) {
          loadMore();
        }
      }, {
        rootMargin: '200px', // Load when user is 200px from bottom
        threshold: 0
      });
      
      observer.observe(sentinel);
      
      // Also add scroll listener for immediate response on little scroll
      window.addEventListener('scroll', handleScroll);
    }
    
    // Scroll handler for auto-loading on scroll
    let scrollTimeout;
    function handleScroll() {
      if (scrollTimeout) return;
      
      scrollTimeout = requestAnimationFrame(() => {
        // Always try to load more if there's a nextPageToken and not loading
        if (nextPageToken && !isLoading) {
          const scrollHeight = document.documentElement.scrollHeight;
          const clientHeight = document.documentElement.clientHeight;
          const scrollTop = window.scrollY || document.documentElement.scrollTop;
          const scrollBottom = scrollHeight - scrollTop - clientHeight;
          
          // Trigger when within 200px of bottom
          if (scrollBottom < 200) {
            loadMore();
          }
        }
        scrollTimeout = null;
      });
    }
    
    async function searchPlaces() {
      const location = document.getElementById('locationInput').value.trim();
      const type = document.getElementById('typeInput').value;
      // For "all" type, search without specific place type
      const query = type === 'all' ? location : `${type} in ${location}`;
      const resultsDiv = document.getElementById('results');
      const searchBtn = document.getElementById('searchBtn');
      const statsDiv = document.getElementById('stats');
      const sectionTitle = document.getElementById('sectionTitle');
      const infiniteLoader = document.getElementById('infiniteLoader');

      if (!location) {
        resultsDiv.innerHTML = '<div class="error">Please enter a location</div>';
        return;
      }

      // Reset state
      allResults = [];
      nextPageToken = null;
      currentLocation = location;
      currentType = type;
      isLoading = true;

      resultsDiv.innerHTML = '<div class="loading"><div class="spinner"></div><p>Searching for places...</p></div>';
      searchBtn.disabled = true;
      statsDiv.style.display = 'none';
      infiniteLoader.style.display = 'none';
      sectionTitle.textContent = `Searching in ${location}...`;

      try {
        const response = await fetch(`${API_URL}?query=${encodeURIComponent(query)}&type=${encodeURIComponent(type)}`);
        const data = await response.json();

        if (data.error) {
          resultsDiv.innerHTML = `<div class="error">${data.error}</div>`;
          isLoading = false;
          return;
        }

        if (!data.results || data.results.length === 0) {
          resultsDiv.innerHTML = `
            <div class="no-results">
              <div class="icon">üîç</div>
              <h3>No places found</h3>
              <p>Try a different location or category</p>
            </div>`;
          sectionTitle.textContent = 'No Results';
          isLoading = false;
          return;
        }

        // Store results and pagination token
        allResults = data.results;
        nextPageToken = data.next_page_token || null;
        console.log('Initial search results:', allResults.length, 'nextPageToken:', nextPageToken);

        // Update stats and title
        document.getElementById('resultCount').textContent = allResults.length;
        document.getElementById('cityDisplay').textContent = location;
        document.getElementById('locationDisplay').textContent = location;
        document.getElementById('typeDisplay').textContent = type.charAt(0).toUpperCase() + type.slice(1);
        statsDiv.style.display = 'flex';
        sectionTitle.textContent = `Top ${allResults.length} ${type.charAt(0).toUpperCase() + type.slice(1)} in ${location}`;

        // Render cards
        resultsDiv.innerHTML = allResults.map((place, index) => createCardHTML(place, index)).join('');

        // Update total results count
        updateTotalResults();

        // Setup infinite scroll observer
        setupObserver();

        // Show loader if more results available
        if (nextPageToken) {
          infiniteLoader.style.display = 'flex';
        }

        isLoading = false;
      } catch (error) {
        resultsDiv.innerHTML = `<div class="error">Failed to connect to API: ${error.message}</div>`;
        isLoading = false;
      } finally {
        searchBtn.disabled = false;
      }
    }
    
    async function loadMore() {
      if (isLoading || !nextPageToken) {
        console.log('LoadMore skipped:', { isLoading, nextPageToken: !!nextPageToken });
        return;
      }
      
      const infiniteLoader = document.getElementById('infiniteLoader');
      const resultsDiv = document.getElementById('results');
      const searchBtn = document.getElementById('searchBtn');
      
      isLoading = true;
      infiniteLoader.style.display = 'flex';
      searchBtn.disabled = true;

      console.log('Loading more results, token:', nextPageToken);

      try {
        const location = currentLocation;
        const type = currentType;
        
        // Check if this is a progressive search token
        if (nextPageToken && nextPageToken.startsWith('page_')) {
          const tokenMatch = nextPageToken.match(/page_(\d+)_radius_(\d+)/);
          if (tokenMatch) {
            const page = tokenMatch[1];
            const radius = tokenMatch[2];
            console.log('Progressive search:', { page, radius, location });
            const response = await fetch(`${API_URL}?query=${encodeURIComponent(location)}&type=${type}&page=${page}&radius=${radius}`);
            const data = await response.json();
            console.log('Progressive search response:', data);

            if (data.results && data.results.length > 0) {
              allResults = [...allResults, ...data.results];
              nextPageToken = data.next_page_token || null;

              const newCardsHTML = data.results.map((place, index) => createCardHTML(place, allResults.length - data.results.length + index)).join('');
              resultsDiv.insertAdjacentHTML('beforeend', newCardsHTML);

              document.getElementById('resultCount').textContent = allResults.length;
              sectionTitle.textContent = `Top ${allResults.length} ${type.charAt(0).toUpperCase() + type.slice(1)} in ${location}`;
              updateTotalResults();
              console.log('Added', data.results.length, 'new results. Total:', allResults.length);
            } else {
              nextPageToken = null;
              console.log('No more results from progressive search');
            }
          }
        } else {
          // Standard Google pagination
          console.log('Standard pagination, token:', nextPageToken);
          const response = await fetch(`${API_URL}?query=${encodeURIComponent(location)}&type=${type}&pagetoken=${encodeURIComponent(nextPageToken)}`);
          const data = await response.json();
          console.log('Standard pagination response:', data);

          if (data.results && data.results.length > 0) {
            allResults = [...allResults, ...data.results];
            nextPageToken = data.next_page_token || null;

            const newCardsHTML = data.results.map((place, index) => createCardHTML(place, allResults.length - data.results.length + index)).join('');
            resultsDiv.insertAdjacentHTML('beforeend', newCardsHTML);

            document.getElementById('resultCount').textContent = allResults.length;
            sectionTitle.textContent = `Top ${allResults.length} ${type.charAt(0).toUpperCase() + type.slice(1)} in ${location}`;
            updateTotalResults();
            console.log('Added', data.results.length, 'new results. Total:', allResults.length);
          } else {
            nextPageToken = null;
            console.log('No more results from standard pagination');
          }
        }

        if (nextPageToken) {
          infiniteLoader.style.display = 'flex';
        } else {
          infiniteLoader.style.display = 'none';
        }
      } catch (error) {
        console.error('Error loading more results:', error);
        infiniteLoader.style.display = 'flex';
      } finally {
        isLoading = false;
        searchBtn.disabled = false;
      }
    }

    // Allow Enter key to search
    document.getElementById('locationInput').addEventListener('keypress', (e) => {
      if (e.key === 'Enter') searchPlaces();
    });
    
    // Custom Toast Notification
    function showToast(message) {
      const toast = document.getElementById("toast");
      toast.className = "toast show";
      toast.textContent = message;
      setTimeout(function(){ 
        toast.className = toast.className.replace("show", ""); 
      }, 3000);
    }
    
    // View place details
    async function viewPlaceDetails(placeId) {
      try {
        // Use the backend API instead of direct Google Maps API call
        const response = await fetch(`${API_BASE_URL}/place-details?place_id=${encodeURIComponent(placeId)}`);
        const data = await response.json();

        if (data.result) {
          displayPlaceDetails(data.result);
        } else {
          console.error('No place details found:', data);
        }
      } catch (error) {
        console.error('Error fetching place details:', error);
        // Fallback to display basic info if available
        displayPlaceDetails({
          place_id: placeId,
          name: 'Place Details',
          formatted_address: 'Address not available',
          formatted_phone_number: 'Phone not available',
          website: null,
          rating: 0,
          user_ratings_total: 0,
          reviews: [],
          photos: [],
          types: ['place'],
          opening_hours: { weekday_text: ['Hours not available'] },
          business_status: 'Status not available'
        });
      }
    }
    

    // Auto-search on type change
    document.getElementById('typeInput').addEventListener('change', () => {
      if (document.getElementById('locationInput').value.trim()) {
        searchPlaces();
      }
    });

    // Modal functions
    function closeModal() {
      document.getElementById('modal').style.display = 'none';
      // Reset carousel
      currentImages = [];
      currentImageIndex = 0;
      // Cleanup reviews observer
      if (window.reviewsObserver) {
        window.reviewsObserver.disconnect();
        window.reviewsObserver = null;
      }
      window.currentReviews = [];
      window.loadedReviewsCount = 0;
    }

    function displayPlaceDetails(place) {
      // Update title and types
      document.getElementById('place-title').textContent = place.name;
      document.getElementById('place-types').innerHTML = place.types ? place.types.map(t => `<span class="modal-type">${t.replace(/_/g, ' ')}</span>`).join('') : '';

      // Address
      document.getElementById('place-address').textContent = place.formatted_address || 'N/A';

      // Phone
      const phone = place.formatted_phone_number || place.international_phone_number;
      document.getElementById('place-phone').innerHTML = phone ? `<a href="tel:${phone}">${phone}</a>` : 'N/A';

      // Website
      const website = place.website;
      document.getElementById('place-website').innerHTML = website ? `<a href="${website}" target="_blank">${website}</a>` : 'N/A';

      // Status
      document.getElementById('place-status').textContent = place.business_status || 'N/A';

      // Images
      if (place.photos && place.photos.length > 0) {
        currentImages = place.photos.map(photo => `https://maps.googleapis.com/maps/api/place/photo?maxwidth=800&photo_reference=${photo.photo_reference}&key=AIzaSyDq3eLU5UMm5kKZNvwyofR0bC3rMToQ-hw`);
        updateCarousel();
      } else {
        document.getElementById('carousel-container').innerHTML = '<div style="width:100%; height:100%; display:flex; align-items:center; justify-content:center; background:rgba(255,255,255,0.05);">No images available</div>';
        document.getElementById('carousel-indicators').innerHTML = '';
      }

      // Rating
      const ratingDisplay = document.getElementById('rating-display');
      if (place.rating) {
        ratingDisplay.innerHTML = `
          <div class="rating-badge">
            <span class="rating-star">‚òÖ</span>
            <span class="rating-score">${place.rating}</span>
          </div>
          <span class="rating-count">${place.user_ratings_total || 0} reviews</span>
        `;
      } else {
        ratingDisplay.innerHTML = '<span class="rating-count">No ratings yet</span>';
      }

      // Opening hours
      const hoursDiv = document.getElementById('place-hours');
      if (place.opening_hours && place.opening_hours.weekday_text) {
        const today = new Date().getDay(); // 0 = Sunday
        hoursDiv.innerHTML = place.opening_hours.weekday_text.map((hour, index) => {
          const isToday = index === (today === 0 ? 6 : today - 1);
          return `<div class="hour-item ${isToday ? 'today' : ''}">${hour}</div>`;
        }).join('');
      } else {
        hoursDiv.innerHTML = '<div class="hour-item">Hours not available</div>';
      }

      // Reviews with load more functionality
      const reviewsDiv = document.getElementById('place-reviews');
      const allReviews = place.reviews || [];
      
      if (allReviews.length > 0) {
        // Store all reviews globally for load more functionality
        window.currentReviews = allReviews;
        window.loadedReviewsCount = Math.min(5, allReviews.length);
        
        function renderReviews() {
          const loaded = window.loadedReviewsCount;
          const reviewsToShow = window.currentReviews.slice(0, loaded);
          
          reviewsDiv.innerHTML = reviewsToShow.map(review => `
            <div class="review-item">
              <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 10px;">
                ${review.profile_photo_url ? `<img src="${review.profile_photo_url}" alt="${review.author_name}" style="width: 40px; height: 40px; border-radius: 50%; object-fit: cover;">` : ''}
                <div>
                  <div class="review-author">${review.author_name}</div>
                  <div class="review-rating">${'‚òÖ'.repeat(Math.round(review.rating))}</div>
                </div>
              </div>
              <div class="review-text">${review.text}</div>
              ${review.relative_time_description ? `<div style="color: rgba(255,255,255,0.4); font-size: 12px; margin-top: 8px;">${review.relative_time_description}</div>` : ''}
            </div>
          `).join('');
          
          // Add load more button if there are more reviews
          if (loaded < allReviews.length) {
            reviewsDiv.innerHTML += `
              <button id="loadMoreReviews" class="btn-search" onclick="loadMoreReviews()" style="width: 100%; margin-top: 15px;">
                Load More Reviews (${loaded}/${allReviews.length})
              </button>
            `;
          }
        }
        
        renderReviews();
        
        // Auto-loader: setup intersection observer for auto-loading when scrolling to bottom
        window.reviewsObserver = new IntersectionObserver((entries) => {
          const entry = entries[0];
          if (entry.isIntersecting && window.loadedReviewsCount < allReviews.length) {
            loadMoreReviews();
          }
        }, { rootMargin: '100px' });
        
        window.reviewsObserver.observe(reviewsDiv);
      } else {
        reviewsDiv.innerHTML = '<div class="review-item">No reviews available</div>';
      }

      // Show modal
      document.getElementById('modal').style.display = 'flex';
    }

    function updateCarousel() {
      const container = document.getElementById('carousel-container');
      container.innerHTML = currentImages.map((src, index) => `<img class="carousel-image" src="${src}" alt="Place image ${index + 1}">`).join('');
      container.style.transform = `translateX(-${currentImageIndex * 100}%)`;

      const indicators = document.getElementById('carousel-indicators');
      indicators.innerHTML = currentImages.map((_, index) => `<div class="indicator ${index === currentImageIndex ? 'active' : ''}" onclick="goToImage(${index})"></div>`).join('');

      // Show/hide nav buttons
      document.getElementById('carousel-prev').style.display = currentImages.length > 1 ? 'block' : 'none';
      document.getElementById('carousel-next').style.display = currentImages.length > 1 ? 'block' : 'none';
    }

    function nextImage() {
      currentImageIndex = (currentImageIndex + 1) % currentImages.length;
      updateCarousel();
    }

    function prevImage() {
      currentImageIndex = (currentImageIndex - 1 + currentImages.length) % currentImages.length;
      updateCarousel();
    }

    function goToImage(index) {
      currentImageIndex = index;
      updateCarousel();
    }
    
    function loadMoreReviews() {
      const loadMoreBtn = document.getElementById('loadMoreReviews');
      if (loadMoreBtn) {
        loadMoreBtn.innerHTML = 'Loading...';
        loadMoreBtn.disabled = true;
      }
      
      // Simulate loading delay
      setTimeout(() => {
        window.loadedReviewsCount = Math.min(window.loadedReviewsCount + 5, window.currentReviews.length);
        
        // Re-render reviews
        const reviewsDiv = document.getElementById('place-reviews');
        const loaded = window.loadedReviewsCount;
        const allReviews = window.currentReviews;
        const reviewsToShow = allReviews.slice(0, loaded);
        
        reviewsDiv.innerHTML = reviewsToShow.map(review => `
          <div class="review-item">
            <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 10px;">
              ${review.profile_photo_url ? `<img src="${review.profile_photo_url}" alt="${review.author_name}" style="width: 40px; height: 40px; border-radius: 50%; object-fit: cover;">` : ''}
              <div>
                <div class="review-author">${review.author_name}</div>
                <div class="review-rating">${'‚òÖ'.repeat(Math.round(review.rating))}</div>
              </div>
            </div>
            <div class="review-text">${review.text}</div>
            ${review.relative_time_description ? `<div style="color: rgba(255,255,255,0.4); font-size: 12px; margin-top: 8px;">${review.relative_time_description}</div>` : ''}
          </div>
        `).join('');
        
        // Add load more button if there are more reviews
        if (loaded < allReviews.length) {
          reviewsDiv.innerHTML += `
            <button id="loadMoreReviews" class="btn-search" onclick="loadMoreReviews()" style="width: 100%; margin-top: 15px;">
              Load More Reviews (${loaded}/${allReviews.length})
            </button>
          `;
        }
        
        // Update observer
        if (window.reviewsObserver) {
          window.reviewsObserver.disconnect();
          window.reviewsObserver = new IntersectionObserver((entries) => {
            const entry = entries[0];
            if (entry.isIntersecting && window.loadedReviewsCount < window.currentReviews.length) {
              loadMoreReviews();
            }
          }, { rootMargin: '100px' });
          window.reviewsObserver.observe(document.getElementById('place-reviews'));
        }
      }, 500);
    }

    // Close modal on overlay click
    document.getElementById('modal').addEventListener('click', (e) => {
      if (e.target === document.getElementById('modal')) {
        closeModal();
      }
    });

    // Device Info Modal Functions
    function showDeviceInfo() {
      // Update device info
      document.getElementById('device-width').textContent = `${window.screen.width}px`;
      document.getElementById('device-height').textContent = `${window.screen.height}px`;
      document.getElementById('avail-width').textContent = `${window.screen.availWidth}px`;
      document.getElementById('avail-height').textContent = `${window.screen.availHeight}px`;
      document.getElementById('color-depth').textContent = `${window.screen.colorDepth}-bit`;
      document.getElementById('pixel-ratio').textContent = `${window.devicePixelRatio}x`;
      
      // Show modal
      document.getElementById('deviceModal').style.display = 'flex';
    }

    function closeDeviceModal() {
      document.getElementById('deviceModal').style.display = 'none';
    }

    // Close device modal on overlay click
    document.getElementById('deviceModal').addEventListener('click', (e) => {
      if (e.target === document.getElementById('deviceModal')) {
        closeDeviceModal();
      }
    });

    // Keyboard navigation for device modal
    document.addEventListener('keydown', (e) => {
      if (document.getElementById('deviceModal').style.display === 'flex') {
        if (e.key === 'Escape') {
          closeDeviceModal();
        }
      }
    });

    // Keyboard navigation
    document.addEventListener('keydown', (e) => {
      if (document.getElementById('modal').style.display === 'flex') {
        if (e.key === 'Escape') {
          closeModal();
        } else if (e.key === 'ArrowLeft' && currentImages.length > 1) {
          prevImage();
        } else if (e.key === 'ArrowRight' && currentImages.length > 1) {
          nextImage();
        }
      }
    });
  </script>

  <!-- Bottom Navigation Bar -->
  <div class="bottom-nav">
    <button class="nav-btn" onclick="scrollToTop()" title="Scroll to Top">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M18 15l-6-6-6 6"/>
      </svg>
      <span>Auto Scroll</span>
    </button>
    <div class="nav-divider"></div>
    <div class="nav-info">
      <span class="nav-label">Results:</span>
      <span id="totalResults" class="nav-value">0</span>
    </div>
    <div class="nav-divider"></div>
    <button class="nav-btn" onclick="exportToJSON()" title="Export as JSON">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
        <polyline points="14 2 14 8 20 8"/>
        <line x1="16" y1="13" x2="8" y2="13"/>
        <line x1="16" y1="17" x2="8" y2="17"/>
        <polyline points="10 9 9 9 8 9"/>
      </svg>
      <span>JSON</span>
    </button>
    <button class="nav-btn" onclick="exportToCSV()" title="Export as CSV">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
        <polyline points="14 2 14 8 20 8"/>
        <line x1="16" y1="13" x2="8" y2="13"/>
        <line x1="16" y1="17" x2="8" y2="17"/>
      </svg>
      <span>CSV</span>
    </button>
  </div>

  <style>
    .bottom-nav {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      height: 60px;
      background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
      border-top: 1px solid rgba(255,255,255,0.1);
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 15px;
      padding: 0 20px;
      z-index: 999;
      box-shadow: 0 -4px 20px rgba(0,0,0,0.3);
    }
    
    .nav-btn {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 10px 20px;
      background: rgba(255,255,255,0.1);
      border: 1px solid rgba(255,255,255,0.2);
      border-radius: 10px;
      color: #fff;
      font-size: 14px;
      cursor: pointer;
      transition: all 0.3s;
    }
    
    .nav-btn:hover {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      border-color: transparent;
      transform: translateY(-2px);
    }
    
    .nav-btn svg {
      width: 18px;
      height: 18px;
    }
    
    .nav-divider {
      width: 1px;
      height: 30px;
      background: rgba(255,255,255,0.2);
    }
    
    .nav-info {
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .nav-label {
      color: rgba(255,255,255,0.6);
      font-size: 14px;
    }
    
    .nav-value {
      color: #fff;
      font-size: 18px;
      font-weight: 700;
      background: linear-gradient(90deg, #667eea, #764ba2);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }
    
    .results-section {
      padding-bottom: 100px;
    }
    
    @media (max-width: 768px) {
      .bottom-nav {
        height: auto;
        padding: 15px;
        flex-wrap: wrap;
        gap: 10px;
      }
      
      .nav-btn {
        padding: 8px 12px;
        font-size: 12px;
      }
      
      .nav-divider {
        display: none;
      }
      
      .results-section {
        padding-bottom: 180px;
      }
    }
  </style>

  <script>
    // Update total results count
    function updateTotalResults() {
      const resultCount = allResults.length;
      document.getElementById('totalResults').textContent = resultCount;
    }

    // Scroll to top function
    function scrollToTop() {
      window.scrollTo({
        top: 0,
        behavior: 'smooth'
      });
    }

    // Export to JSON
    function exportToJSON() {
      if (allResults.length === 0) {
        showToast('No results to export');
        return;
      }
      
      const data = {
        searchLocation: currentLocation,
        searchType: currentType,
        totalResults: allResults.length,
        exportDate: new Date().toISOString(),
        places: allResults.map(place => ({
          name: place.name,
          address: place.formatted_address || place.vicinity,
          rating: place.rating,
          totalRatings: place.user_ratings_total,
          types: place.types,
          location: {
            lat: place.geometry?.location?.lat,
            lng: place.geometry?.location?.lng
          },
          placeId: place.place_id,
          openNow: place.opening_hours?.open_now,
          priceLevel: place.price_level,
          businessStatus: place.business_status
        }))
      };
      
      const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `gapi-results-${currentLocation.replace(/\s+/g, '-')}-${new Date().toISOString().split('T')[0]}.json`;
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
      
      showToast('JSON exported successfully!');
    }

    // Export to CSV
    function exportToCSV() {
      if (allResults.length === 0) {
        showToast('No results to export');
        return;
      }
      
      const headers = ['Name', 'Address', 'Rating', 'Total Ratings', 'Types', 'Latitude', 'Longitude', 'Place ID', 'Open Now', 'Price Level', 'Business Status'];
      
      const rows = allResults.map(place => [
        `"${(place.name || '').replace(/"/g, '""')}"`,
        `"${(place.formatted_address || place.vicinity || '').replace(/"/g, '""')}"`,
        place.rating || '',
        place.user_ratings_total || '',
        `"${(place.types || []).join(', ').replace(/"/g, '""')}"`,
        place.geometry?.location?.lat || '',
        place.geometry?.location?.lng || '',
        place.place_id || '',
        place.opening_hours?.open_now ? 'Yes' : 'No',
        place.price_level || '',
        place.business_status || ''
      ]);
      
      const csvContent = [headers.join(','), ...rows.map(row => row.join(','))].join('\n');
      
      const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `gapi-results-${currentLocation.replace(/\s+/g, '-')}-${new Date().toISOString().split('T')[0]}.csv`;
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
      
      showToast('CSV exported successfully!');
    }

    // Initialize total results count
    window.addEventListener('DOMContentLoaded', () => {
      updateTotalResults();
    });
  </script>
</body>
</html>